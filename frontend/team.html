<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>团队地图 - 团建地点推荐</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>团建地点推荐</h2>
                <div class="team-info">
                    <span id="team-name-display"></span>
                    <button class="btn small" id="leave-team-btn">退出</button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>我的位置 <span class="badge" id="location-count">0</span></h3>
                <div class="location-search">
                    <input type="text" id="address-search" placeholder="搜索地址">
                    <button class="btn small" id="search-btn">添加</button>
                </div>
                <div class="selected-location" id="selected-location">
                    <p class="empty-hint">点击地图或搜索添加位置</p>
                </div>
                <div class="my-locations-list" id="my-locations-list"></div>
                <button class="btn secondary small full-width" id="clear-locations-btn" style="margin-top: 8px; display: none;">清空所有位置</button>
            </div>

            <div class="sidebar-section">
                <h3>推荐设置</h3>

                <div class="setting-group">
                    <label>交通工具</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="transport" value="driving" checked>
                            <span>驾车</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="transport" value="transit">
                            <span>公交/地铁</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="transport" value="walking">
                            <span>步行</span>
                        </label>
                    </div>
                </div>

                <div class="setting-group">
                    <label>最大到达时间: <span id="time-value">30</span> 分钟</label>
                    <input type="range" id="time-threshold" min="15" max="90" step="15" value="30">
                </div>

                <div class="setting-group">
                    <label>场所类型</label>
                    <select id="place-type">
                        <option value="050000">餐饮</option>
                        <option value="080000">娱乐</option>
                        <option value="100000">购物</option>
                        <option value="110000">酒店</option>
                        <option value="120000">景点</option>
                    </select>
                </div>

                <div class="setting-group">
                    <label>排序方式</label>
                    <div class="radio-group">
                        <label class="radio-item">
                            <input type="radio" name="sort" value="max" checked>
                            <span>最远到达时间</span>
                        </label>
                        <label class="radio-item">
                            <input type="radio" name="sort" value="avg">
                            <span>平均到达时间</span>
                        </label>
                    </div>
                </div>

                <button class="btn primary full-width" id="find-places-btn">查找合适地点</button>
            </div>

            <div class="sidebar-section results-section">
                <h3>推荐结果 <span id="result-count"></span></h3>
                <div class="results-list" id="results-list">
                    <p class="empty-state">设置条件后点击"查找合适地点"</p>
                </div>
            </div>
        </aside>

        <main class="map-container">
            <div id="map"></div>
            <div class="member-list" id="member-list">
                <h4>团队成员</h4>
                <div id="members-container"></div>
            </div>
        </main>
    </div>

    <div class="modal" id="place-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-place-name"></h3>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="modal-place-address"></p>
                <div class="travel-times" id="modal-travel-times"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3"></script>
    <script src="js/supabase.js"></script>
    <script src="js/auth.js"></script>

    <!-- 高德地图API安全配置 -->
    <script type="text/javascript">
      window._AMapSecurityConfig = {
        serviceHost: "/_AMapService",
      };
    </script>

    <!-- 高德地图API -->
    <script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=fb189d59346f33c09492c4b27e13fcda&plugin=AMap.Driving,AMap.Transfer,AMap.Walking"></script>

    <script src="js/map.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
